import{b,N as A}from"./index-4Reshhrb.js";import{$ as n,a as M}from"./discrete-api-XxHpaVLK.js";import{B as m}from"./Button-DeChHw9F.js";import{d as S,r as y,N as V,n as p,q as s,s as l,z as c,x as o,F as _,B as z,D as F,A as w,S as v}from"./index-CACFgO7V.js";import{_ as L}from"./plugin-vueexport-helper-CWQnwBKe.js";import"./Scrollbar-CrXVcVYz.js";const P={class:"file-list"},q={class:"file-item"},H={class:"file-name"},I={class:"file-preview"},O=S({__name:"FileManager",setup(R){const{open:h,onChange:k}=b();k(async t=>{for(let e=0;e<t.length;e++)await x(t[e])});let i;const u=y([]);function C(t){return new Promise((e,a)=>{M.warning({title:"警告",closeOnEsc:!1,closable:!1,maskClosable:!1,content:`已存在文件【${t}】，是否覆盖？`,positiveText:"覆盖",negativeText:"跳过",onPositiveClick:()=>{e(!0)},onNegativeClick:()=>{a(!1)}})})}async function x(t){const e=await i.getFileHandle(t.name,{create:!0}),a=await e.getFile();try{a.size>0&&await C(t.name);const r=await e.createWritable();await r.truncate(0),await r.write(await t.arrayBuffer()),await r.close(),await d()}catch{console.log("取消保存")}}async function d(){try{u.value=[];for await(let[t,e]of i.entries())u.value.push({name:t,handle:e})}catch(t){t instanceof Error?n.error(t.message):n.error("An unknown error occurred")}}const f=y("");async function B(t){const r=(await t.getFile()).stream().getReader(),$=new TextDecoder("utf-8");f.value="";const g=({done:E,value:T})=>{if(E)return;const D=$.decode(T);return f.value+=D,r.read().then(g)};r.read().then(g)}async function N(t){try{await i.removeEntry(t.name,{recursive:!0}),await d(),n.success("删除成功")}catch(e){e instanceof Error?n.error(e.message):n.error("An unknown error occurred")}}return V(async()=>{i=await navigator.storage.getDirectory(),await d()}),(t,e)=>(w(),p(_,null,[s("header",null,[l(o(m),{onClick:e[0]||(e[0]=a=>o(h)()),type:"primary"},{default:c(()=>e[1]||(e[1]=[v("添加文件")])),_:1})]),s("main",null,[s("div",P,[(w(!0),p(_,null,z(u.value,a=>(w(),p("div",q,[s("div",H,F(a.name),1),l(o(A),{class:"operate"},{default:c(()=>[l(o(m),{onClick:r=>B(a.handle),type:"primary"},{default:c(()=>e[2]||(e[2]=[v("读取")])),_:2},1032,["onClick"]),l(o(m),{onClick:r=>N(a.handle),type:"error"},{default:c(()=>e[3]||(e[3]=[v("删除")])),_:2},1032,["onClick"])]),_:2},1024)]))),256))]),s("div",I,F(f.value),1)])],64))}}),U=L(O,[["__scopeId","data-v-0dd97a6d"]]);export{U as default};
